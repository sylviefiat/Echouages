/*
 *  Project: timepickerByGiro jQuery plugin
 *  Description: a lightweight timepicker based on bootstrap
 *  Author: Girolamo Tomaselli http://bygiro.com
 *  Dual licensed under the MIT and GPL licenses.
 */
;!function(a,b,c){"use strict";var e="timepickerByGiro",f="plugin_"+e,g={time:"",step:1,start:null,end:null,format:"H:i",uiFormat:"H:i",onChange:!1,onInit:!1},h=function(b,d,e){var f=a.Event(b);e instanceof Array||(e=[e]),e.unshift(this),a(c).triggerHandler(f,e),this.options.$element.triggerHandler(f,e),a.isFunction(d)&&d.call(this,e)},i=function(a,b){return String(a).replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\"+(b||"")+"-]","g"),"\\$&")},j=function(){var b=this.options,c="";this.options.$parent=b.$element.parent(),this.options.$parent.hasClass("input-append")||this.options.$parent.hasClass("input-prepend")?this.options.$parent.addClass("timepicker_container"):this.options.$parent=b.$element.wrap('<div class="timepicker_container"></div>').parent();var d=this.options.$element.clone(!0);d.attr("id","").attr("name","").addClass("fakeInput").attr("readonly","readonly").show(),this.options.$parent.append(d),this.options.$fake=this.options.$parent.find(".fakeInput"),c='<div class="timepicker_popover"><span class="btn-close-popover">&times;</span><table class="table"><tbody><tr><td class="hours"><i class="picknext icomoon icon-chevron-up"></i><span class="clearfix"></span><input type="text" class="input_micro" readonly><span class="clearfix"></span><i class="pickprevious icomoon icon-chevron-down"></i></td><td class="time_separator">:</td><td class="minutes"><i class="picknext icomoon icon-chevron-up"></i><span class="clearfix"></span><input type="text" class="input_micro" readonly><span class="clearfix"></span><i class="pickprevious icomoon icon-chevron-down"></i></td></tr></tbody></table></div>',this.options.$parent.append(c)},k=function(a){var c=this.options,d=this.options.$element.val();d||(d=this.options.time),d=t(d,c.format),d=o.call(this,d,a),n.call(this,d)},l=function(a){var d,e,f,g,h,c=this.options;g=c.$parent.find(".timepicker_popover .hours input").val(),h=c.$parent.find(".timepicker_popover .minutes input").val(),d=m(g,h),d=o.call(this,d,a),e=u(d,c.format),f=u(d,c.uiFormat),c.$element.val(e).trigger("keyup"),c.$fake.val(f)},m=function(a,b){a=parseInt(a),b=parseInt(b);var c=r(a),d=r(b);if(!c||!d)var e=new Date;return a=c?a:e.getHours(),b=d?b:e.getMinutes(),{h:a,m:b}},n=function(a){var d,e,c=this.options;d=q(a.h),e=q(a.m),c.$parent.find(".timepicker_popover .hours input").val(d),c.$parent.find(".timepicker_popover .minutes input").val(e)},o=function(a,b){var d=this.options;return b="+"!=b&&"-"!=b?null:"+"==b?"+":"-",d.start||d.end?(a.h<d.start.h&&(a.h=d.start.h,"-"==b&&(a.h=d.end.h)),a.h==d.start.h&&a.m<d.start.m&&(a.m=d.start.m),a.h>d.end.h&&(a.h=d.end.h,"+"==b&&(a.h=d.start.h)),a.h==d.end.h&&a.m>d.end.m&&(a.m=d.end.m),a):a},p=function(a,b){var d=this.options,a="hours"==a?a:"minutes",e=d.$parent.find("."+a+" input"),f=parseInt(e.val()),b="+"==b?"+":"-",g=d.step,i=60;f=f>=0?f:0,"hours"==a&&(g=1,i=24),"-"==b?f-=g:f+=g,f>=i?f=0:0>f&&(f=i-g),e.val(f),l.call(this,b),k.call(this,b),h.call(this,this.options.event_changed,this.options.onChange,[])},q=function(a){return 1==a.toString().length&&(a="0"+a.toString()),a},r=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},s=function(a){return a=a.replace(/h/gi,"%1%"),a=a.replace(/i/gi,"%1%"),a=i(a,"/"),new RegExp(a.replace(/%1%/g,"([0-9]+)"),"i")},t=function(a,b){var c,d,e,f,g;return"string"==typeof a||a?("U"==b&&r(a)?(a=parseInt(a),g=a/60,f=Math.floor(g/60),g-=60*f,f>23&&(multiple=Math.floor(f/24),f-=24*multiple),c={h:f,m:g}):(d=s(b),"function"==typeof a.match&&(e=a.match(d)),f=0,g=0,e&&e.length>0&&(f=e[1],g=e[2]),c=m(f,g)),c):m()},u=function(a,b){return"U"==b?b=3600*a.h+60*a.m:(b=b.replace(/h/i,q(a.h)),b=b.replace(/i/i,q(a.m))),b},v=function(){this.element.parent().find(".pickprevious, .picknext").off(),this.element.parent().off()},w=function(){var a=this,b=this.options;b.$parent.on("click",function(a){a.preventDefault(),a.stopPropagation(),jQuery(this).addClass("open")}),b.$parent.find(".timepicker_popover .btn-close-popover").on("click",function(a){a.preventDefault(),a.stopPropagation(),jQuery(this).closest(".timepicker_container").removeClass("open")}),b.$parent.find(".pickprevious, .picknext").on("click",function(b){b.preventDefault(),b.stopPropagation();var c=jQuery(this).hasClass("picknext")?"+":"-";jQuery(this).parent().hasClass("hours")?p.call(a,"hours",c):p.call(a,"minutes",c)})},x=function(b){this.others_opts={event_changed:e+"_changed",event_initialized:e+"_initialized",initialized:!1,$element:a(b)},this.options=a.extend({},g)};x.prototype={init:function(b){if(!this.options.initialized&&(this.options.$element=a(this.element),this.options.$element.is('input[type="text"]'))){var c=this.options.$element,d={},e=c.data();for(var f in this.options)"undefined"!=typeof e[f]&&(d[f]=e[f]);this.options=a.extend({},this.options,b,d,this.others_opts);var g=this.options;g.step=parseInt(g.step),g.step=g.step>0&&g.step<59?g.step:1,"string"==typeof g.start&&g.start&&(g.start=t(g.start,g.format)),"string"==typeof g.end&&g.end&&(g.end=t(g.end,g.format)),this.options=g,c.hide(),j.call(this),w.call(this),k.call(this),l.call(this),this.options.initialized=!0,h.call(this,this.options.event_initialized,this.options.onInit,[])}},strToDate:function(a,b){return t(a,b)},dateToStr:function(a,b){return u(a,b)},destroy:function(){this.element.parent().find(".timepicker_popover").remove(),this.element.parent().find(".fakeInput").remove(),this.element.parent().hasClass("input-prepend")?this.element.parent().removeClass("timepicker_container"):this.element.parent().replaceWith(this.element.parent().contents),v.call(this),this.element.data(f,null)}},a.fn[e]=function(b){var c,d;if(this.length<=0&&"string"!=typeof b)return this;if(this.data(f)instanceof x||this.data(f,new x(this)),d=this.data(f),"undefined"!=typeof d?d.element=this:d=new x(this),"undefined"==typeof b||"object"==typeof b)"function"==typeof d.init&&d.init(b);else{if("string"==typeof b&&"function"==typeof d[b])return c=Array.prototype.slice.call(arguments,1),d[b].apply(d,c);a.error("Method "+b+" does not exist on jQuery."+e)}}}(jQuery,window,document),jQuery(document).ready(function(){jQuery("body").on("click",function(){jQuery(this).find(".timepicker_container.open").each(function(){jQuery(this).removeClass("open")})})});