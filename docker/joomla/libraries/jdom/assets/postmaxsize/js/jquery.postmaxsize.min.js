/*
 *  Project: jQuery Post Max Size plugin
 *  Description: it checks if the form  meets the Server side limits to post a form
 *  Author: Girolamo Tomaselli http://bygiro.com
 *  License: GNU General Public License
 */
;!function(t,e,i,n){"use strict";var s="postMaxSize",o="plugin_"+s,a={max_input_vars:1e3,post_max_size:1e8,max_file_uploads:20,upload_max_filesize:1e8,message_1:65,message_2:80,message_3:95,text:{message_1:"You are reaching the max limit for this form to be processed, please save it, before to continue",message_2:"I strongly suggest you to save the form, before to continue your editing",message_3:"ATTENTION!! you may lose all the modifications on this form, you should immediately save the form!"},onInit:!1,onChecked:!1,onMaxInputVarsReached:!1,onMaxFileUploadsReached:!1,onPostMaxSizeReached:!1,onUploadMaxFilesizeReached:!1},r=function(e,n){var s=t.Event(e),o=this.events[e];return n instanceof Array||(n=[n]),n.unshift(this),t(i).triggerHandler(s,n),this.element.triggerHandler(s,n),"function"==typeof o?o.call(this,n):!0},l=function(){},p=function(){var e=this;e.element.find("input,select,textarea").on("keyup change click",function(i){var s,o=1200,a=!1,r=t(this),l=r.get(0).tagName,p=r.attr("type");switch(p=n!==p?"_"+p:"",s=l+p,s=s.toLowerCase()){case"select":case"input_hidden":case"input_file":"change"==i.type&&(a=!0,o=50);break;case"input_radio":case"input_checkbox":"click"==i.type&&(a=!0,o=50);break;case"input_text":case"textarea":default:"keyup"==i.type&&(a=!0)}a&&h(function(){d.call(e)},o)})},c=function(t,e){for(var i=this,n={limit_1:parseInt(i.options.message_1*e/100)||0,limit_2:parseInt(i.options.message_2*e/100)||0,limit_3:parseInt(i.options.message_3*e/100)||0},s=3;s>0;s--)if(n["limit_"+s]&&t>=n["limit_"+s])return s;return!1},d=function(){var e,i,n=this,s=!1,o=[],a=n.element.find("select,input,textarea"),r=t();n.element.find("[data-cloner-group]").each(function(){var e=jQuery(this).attr("data-target-field");e&&(r=r.add(t(this).find("input,textarea,select").not(t(e))))}),a.not(r);for(var l=["max_input_vars","post_max_size","max_file_uploads","upload_max_filesize"],p=a.serializeArray(),d=0;d<l.length;d++){var h=l[d];if(!s&&n.options[h]>0){switch(h){case"max_input_vars":i=p.length;break;case"post_max_size":i=u(JSON.stringify(p));break;case"max_file_uploads":i=a.filter(function(){return t(this).is("input[type='file']")?this.value:!1}).length;break;case"upload_max_filesize":i=0}i&&(s=c.call(n,i,n.options[h]),o=[h,i,n.options[h]])}}return s&&"undefined"!=e&&(e=typeof n.options.text["message_"+s],"function"==e?n.options.text["message_"+s].apply(o):"string"==e&&alert(n.options.text["message_"+s])),!(s?!0:!1)},u=function(t){for(var e=0,i=0;i<t.length;i++){var n=t.charCodeAt(i);128>n?e++:e+=n>127&&2048>n?2:3}return e},h=function(){var t=0;return function(e,i){clearTimeout(t),t=setTimeout(e,i)}}(),f=function(e){0==typeof e.length&&(e=t("body")),this.element=e,this.events={},this.events[s+"_initialized"]="onInit",this.events[s+"_checked"]="onChecked",this.events[s+"_max_input_vars_reached"]="onMaxInputVarsReached",this.events[s+"_max_file_uploads_reached"]="onMaxFileUploadsReached",this.events[s+"_post_max_size_reached"]="onPostMaxSizeReached",this.events[s+"_upload_max_filesize_reached"]="onUploadMaxFilesizeReached"};f.prototype={init:function(e){var i=this.element.data();this.options=t.extend(a,i,e),p.call(this),r.call(this,s+"_initialized",[])},check:function(){var t=this;h(function(){d.call(t)},300)},destroy:function(){l.call(this)}},t.fn[s]=function(e){var i,a;if(t(this).data(o)instanceof f||t(this).data(o,new f(t(this))),a=t(this).data(o),a.element=t(this),n===e||"object"==typeof e)"function"==typeof a.init&&a.init(e);else{if("string"==typeof e&&"function"==typeof a[e])return i=Array.prototype.slice.call(arguments,1),a[e].apply(a,i);t.error("Method "+e+" does not exist on jQuery."+s)}return this}}(jQuery,window,document);