/*
* @name			Multiselect jQuery plugin
* @version		0.0.1
* @package		jForms
* @copyright	G. Tomaselli
* @author		Girolamo Tomaselli - http://bygiro.com - girotomaselli@gmail.com
* @license		GNU GPL v3 or later
*/
;!function(t,e,i,s){"use strict";var n="multiselectByGiro",o="plugin_"+n,a={direction:"vertical",allowCustomValues:!1,hideSelect:!1,onInit:!1,onSelect:!1,onRemove:!1},r=function(e,s){t(i).trigger(e),this.options.$events.trigger(e),t.isFunction(s)&&s.call(this.element)},l=function(){var e=this.options.multi.html();if(this.options.single=t("<select>"+e+"</select>"),this.options.single.addClass(this.options.multi.attr("class")).addClass("select-many"),"vertical"==this.options.direction)var i=parseInt(this.options.multi.outerWidth());var s="";i>0&&(s='style="max-width:'+i+'px;"'),this.options.container=t('<span class="multiselect-container"/>'),this.options.container.append(this.options.single),this.options.allowCustomValues&&(this.options.inputCustom=t('<input autocomplete="off" type="text" size="10" value="" class="multiselect_custom_values"/>'),this.options.container.append(this.options.inputCustom)),"vertical"==this.options.direction&&this.options.container.append("<br />"),this.options.list=t("<ul "+s+' class="select-many-selected"></ul>'),this.options.container.append(this.options.list),this.options.multi.after(this.options.container)},p=function(e,i){if(e.attr("value")&&""!=e.attr("value").trim()){var n=t("<li></li>").text(e.text()+" "),o=e.val(),i=s!==i?i:!0;t.data(n[0],"value",o),this.options.list.append(n),this.options.blank.attr("selected",!1);var a=this.options.multi.val();"string"==typeof a?a=[a]:t.isArray(a)||(a=[]),a.push(o),i&&this.options.multi.val(a).trigger("change"),this.options.single.find('option[value="'+o+'"]').attr("disabled",!0).addClass("invalid").attr("selected",!1).trigger("change");var l=""!=this.id?"_"+this.id:"";r.call(this,this.options.event_selected+l,this.options.onSelect)}},c=function(){var t=this.options.inputCustom.val();if(s!==t&&(t=t.trim()),""!=t){0==this.options.multi.find('option[value="'+t+'"]').length&&this.options.multi.append('<option value="'+t+'">'+t+"</option>");var e=this.options.single.find('option[value="'+t+'"]');0==e.length?this.options.single.append('<option selected="selected" value="'+t+'">'+t+"</option>"):s!==e.attr("disabled")&&""!=e.attr("disabled")&&e.prop("disabled")||e.prop("selected",!0).attr("selected","selected"),this.options.single.trigger("change"),this.options.inputCustom.val("")}},d=function(){var t=this.options.single.find("option:selected");p.call(this,t)},u=function(e){var i=e.target,s=t.data(i,"value");t(i).remove();var n=this.options.multi.val();"string"==typeof n?n=[n]:t.isArray(n)||(n=[]),n.splice(n.indexOf(s),1),n.length>0?this.options.multi.val(n).trigger("change"):this.options.multi.val("").trigger("change"),this.options.single.find('option[value="'+s+'"]').attr("disabled",!1).removeClass("invalid"),0==this.options.multi.find("option:selected").size()&&this.options.blank.attr("selected",!0);var o=""!=this.id?"_"+this.id:"";r.call(this,this.options.event_removed+o,this.options.onRemove)},h=function(){this.others_opts={event_initialized:n+"_initialized",event_removed:n+"_removed",event_selected:n+"_selected",single:null,multi:null,container:null,inputCustom:!1,initialized:!1,$events:t("<a/>")},this.options=t.extend({},a)};h.prototype={init:function(e){var i=this;if(!this.options.initialized){var s=this.element.data();t.extend(this.options,s,e,this.others_opts),this.id=this.element.attr("id"),this.element.is("select")||t.each(this.element.find("select"),function(){i.init(e)}),this.options.multi=this.element,this.options.multi.hide(),this.options.blank=this.options.multi.find("option:first-child"),(0==this.options.blank.length||""!=this.options.blank.attr("value").trim())&&(this.options.blank=t('<option value=""></option>'),this.options.multi.prepend(this.options.blank)),this.options.blank.attr("selected",!0),l.call(i),this.options.multi.find("option:selected").each(function(){p.call(i,t(this))});var i=this;this.options.single.on("change",function(t){t.stopPropagation(),d.call(i,t)}),this.options.multi.on("change",function(t){t.stopPropagation(),i.refresh()}),this.options.list.on("click","li",function(t){t.stopPropagation(),u.call(i,t)}),this.options.inputCustom&&this.options.inputCustom.on("keypress",function(t){var e=t.keyCode||t.which;switch(e){case 13:case 9:t.preventDefault(),c.call(i,t)}}),this.options.hideSelect&&this.options.single.hide(),this.options.initialized=!0;var n=""!=this.id?"_"+this.id:"";r.call(this,this.options.event_initialized+n,this.options.onInit)}},refresh:function(){var e=this;this.options.list.html(""),this.options.single.html(this.options.multi.html()).find("option[selected]").attr("selected",!1).removeClass("invalid").attr("disabled",!1),this.options.multi.find("option:selected").each(function(){p.call(e,t(this),!1)})},destroy:function(){this.options.initialized=!1,this.options.container.remove(),this.options.multi.show(),this.element.data(o,null)}},t.fn[n]=function(e){var i,a;return this.filter("select"),0==this.length?this:(this.each(function(){if(t(this).data(o)instanceof h||t(this).data(o,new h(t(this))),a=t(this).data(o),a.element=t(this),s===e||"object"==typeof e)"function"==typeof a.init&&a.init(e);else{if("string"==typeof e&&"function"==typeof a[e])return i=Array.prototype.slice.call(arguments,1),a[e].apply(a,i);t.error("Method "+e+" does not exist on jQuery."+n)}}),s)}}(jQuery,window,document);